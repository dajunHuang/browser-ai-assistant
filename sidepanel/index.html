<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LLM 智能助手</title>
  <link rel="stylesheet" href="../lib/katex/katex.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- 设置面板 -->
    <div id="settingsPanel" class="settings-panel hidden">
      <div class="settings-content">
        <h2>API 设置</h2>
        
        <div class="form-group">
          <label for="providerSelect">选择模型提供商</label>
          <select id="providerSelect">
            <option value="gemini">Google Gemini</option>
            <option value="openai">OpenAI (ChatGPT)</option>
            <option value="anthropic">Anthropic (Claude)</option>
          </select>
        </div>

        <div class="form-group">
          <label for="apiKeyInput">API Key</label>
          <input type="password" id="apiKeyInput" placeholder="请输入 API Key">
        </div>

        <div class="form-group">
          <label for="modelSelect">选择模型</label>
          <select id="modelSelect">
            <!-- 动态填充 -->
          </select>
        </div>

        <div class="form-group">
          <label for="systemPrompt">系统提示词</label>
          <textarea id="systemPrompt" placeholder=""></textarea>
          <small class="hint">留空将使用默认提示词</small>
        </div>

        <div class="settings-actions">
          <button id="saveSettings" class="btn btn-primary">保存设置</button>
          <button id="closeSettings" class="btn btn-secondary">关闭</button>
        </div>
      </div>
    </div>

    <!-- 待发送的选中文本提示 -->
    <div id="pendingSelectionBar" class="pending-selection-bar hidden">
      <div class="pending-selection-content">
        <span class="pending-icon">✨</span>
        <span class="pending-text" id="pendingSelectionText">已选中文本，发送时将自动附带</span>
      </div>
      <button id="clearPendingSelection" class="pending-clear" title="取消">✕</button>
    </div>

    <!-- 附件预览区域（多文件/多文本） -->
    <div id="attachmentsBar" class="attachments-bar hidden">
      <div class="attachments-header">
        <span class="attachments-title">📎 附件列表</span>
        <button id="clearAllAttachments" class="text-btn" title="清除全部">清除全部</button>
      </div>
      <div id="attachmentsList" class="attachments-list">
        <!-- 动态添加附件项 -->
      </div>
    </div>

    <!-- 聊天区域 -->
    <div id="chatContainer" class="chat-container">
      <div class="welcome-message">
        <p>👋 你好！我是你的 AI 助手。</p>
        <p>你可以：</p>
        <ul>
          <li>在网页上选中文本后右键发送给我</li>
          <li>上传图片或 PDF 文件进行提问</li>
          <li>直接在输入框提问</li>
        </ul>
        <p class="tip">💡 提示：请先点击下方⚙️配置 API Key</p>
      </div>
    </div>

    <!-- 输入区域 -->
    <div class="input-area">
      <div class="input-wrapper">
        <button id="uploadFileBtn" class="icon-btn upload-btn" title="上传图片或 PDF">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
          </svg>
        </button>
        <input type="file" id="fileInput" accept="image/*,.pdf,application/pdf,.txt,.md,.markdown,.json,.xml,.html,.css,.js,.ts,.jsx,.tsx,.py,.java,.c,.cpp,.h,.go,.rs,.rb,.php,.yaml,.yml,.toml,.ini,.csv,.log,.sql,.sh,text/*" multiple style="display: none;">
        <textarea 
          id="messageInput" 
          placeholder="输入你的问题..."
          rows="1"
        ></textarea>
        <button id="sendBtn" class="send-btn" title="发送">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13"/>
          </svg>
        </button>
      </div>
      <div class="input-actions">
        <label class="context-toggle" title="附带当前页面内容">
          <input type="checkbox" id="includePageContext">
          <span class="toggle-label">📄 附带页面</span>
        </label>
        <button id="clearChatBtn" class="text-btn">清空对话</button>
        <button id="settingsBtn" class="text-btn" title="设置">⚙️ 设置</button>
      </div>
    </div>
  </div>

  <script src="../lib/katex/katex.min.js"></script>
  <script src="script.js" type="module"></script>
</body>
</html>

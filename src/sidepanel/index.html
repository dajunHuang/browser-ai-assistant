<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LLM 智能助手</title>
  <link rel="stylesheet" href="../lib/katex/katex.min.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
  <div class="app-container">
    
    <!-- 设置面板 -->
    <div id="settingsPanel" class="settings-panel hidden">
      <div class="settings-backdrop"></div>
      <div class="settings-content">
        <div class="settings-header">
          <h2>设置</h2>
          <button id="closeSettings" class="close-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
        </div>
        
        <div class="settings-body">
          <div class="form-group">
            <label for="providerSelect">AI 模型提供商</label>
            <div class="select-wrapper">
              <select id="providerSelect">
                <option value="gemini">Google Gemini</option>
                <option value="openai">OpenAI (ChatGPT)</option>
                <option value="anthropic">Anthropic (Claude)</option>
                <option value="deepseek">DeepSeek</option>
              </select>
              <svg class="select-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </div>
          </div>

          <div class="form-group">
            <label for="apiKeyInput">API Key</label>
            <div class="input-wrapper-styled">
              <input type="password" id="apiKeyInput" placeholder="sk-...">
            </div>
          </div>

          <div class="form-group">
            <label for="modelSelect">选择模型</label>
            <div class="select-wrapper">
              <select id="modelSelect">
                <!-- 动态填充 -->
              </select>
              <svg class="select-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </div>
          </div>

          <div class="form-group">
            <label for="systemPrompt">系统提示词 (System Prompt)</label>
            <textarea id="systemPrompt" placeholder="定义 AI 的行为角色..."></textarea>
          </div>
        </div>

        <div class="settings-footer">
          <button id="saveSettings" class="btn btn-primary">保存设置</button>
        </div>
      </div>
    </div>

    <!-- 聊天主区域 -->
    <main class="chat-viewport">
      
      <div class="top-bars">
        <!-- 附件预览区域 (Top) -->
        <div id="attachmentsBar" class="attachments-bar hidden">
          <div class="attachments-header">
            <span class="attachments-title">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
              附件
            </span>
            <button id="clearAllAttachments" class="text-btn-small" title="清除全部">清除</button>
          </div>
          <div id="attachmentsList" class="attachments-list">
            <!-- 动态添加 -->
          </div>
        </div>

        <!-- 待发送的选中文本提示 (Below Attachments) -->
        <div id="pendingSelectionBar" class="pending-selection-bar hidden">
          <div class="pending-selection-content">
                      <div class="pending-icon-wrapper">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                      </div>
                      <div class="pending-text" id="pendingSelectionText">已选中文本</div>
                    </div>          <button id="clearPendingSelection" class="pending-clear" title="取消">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
        </div>
      </div>

      <!-- 消息列表 -->
      <div id="chatContainer" class="chat-container">
        <div class="welcome-message">
          <div class="welcome-icon">👋</div>
          <h3>你好！我是你的 AI 助手</h3>
          <p>我可以帮你分析网页、回答问题或处理文档。</p>
          <div class="welcome-tips">
            <div class="tip-item">
              <span class="tip-icon">🖱️</span>
              <span>选中网页文本右键发送</span>
            </div>
            <div class="tip-item">
              <span class="tip-icon">📄</span>
              <span>上传 PDF 或图片提问</span>
            </div>
          </div>
          <button class="btn-setup" onclick="document.getElementById('settingsBtn').click()">
            配置 API Key 开始使用
          </button>
        </div>
      </div>

    </main>

    <!-- 底部输入区域 -->
    <footer class="input-area">
      <div class="input-tools">
        <label class="tool-btn" title="上传图片或 PDF">
          <input type="file" id="fileInput" accept="image/*,.pdf,application/pdf,.txt,.md,.markdown,.json,.xml,.html,.css,.js,.ts,.jsx,.tsx,.py,.java,.c,.cpp,.h,.go,.rs,.rb,.php,.yaml,.yml,.toml,.ini,.csv,.log,.sql,.sh,text/*" multiple style="display: none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
        </label>
        <button id="uploadFileBtn" class="tool-btn hidden-proxy" style="display:none"></button> 
        
        <label class="tool-btn context-toggle" title="附带当前页面内容">
          <input type="checkbox" id="includePageContext">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
        </label>

        <div class="spacer" style="flex:1"></div>

        <button id="clearChatBtn" class="tool-btn" title="清空对话">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path></svg>
        </button>
        <button id="settingsBtn" class="tool-btn" title="设置">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
        </button>
      </div>
      
      <div class="input-box-wrapper">
        <textarea 
          id="messageInput" 
          placeholder="输入消息..."
          rows="1"
        ></textarea>
        <button id="sendBtn" class="send-btn" title="发送" disabled>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
        </button>
      </div>
    </footer>
  </div>

  <script src="../lib/katex/katex.min.js"></script>
  <script src="../lib/marked.min.js"></script>
  <script type="module" src="js/main.js"></script>
</body>
</html>